{% extends 'base.html' %}

{% block title %}My Favorites{% endblock %}

{% block content %}
<div class="container mt-5">
    <h1 class="text-center">My Favorites</h1>

    {% if favorites %}
    <div class="row mt-4">
        {% for item in favorites %}
        <div class="col-md-4 mb-4">
            <div class="card">
                <img src="{{ url_for('static', filename='car-images/' + item.image_file) }}" class="card-img-top" alt="{{ item.title }}">
                <div class="card-body">
                    <h5 class="card-title">{{ item.title }}</h5>
                    <p class="card-text text-muted">{{ item.description[:100] }}...</p>
                    <p class="card-text text-success">${{ item.price }}</p>
                    <a href="{{ url_for('listing_details', listing_id=item.id) }}" class="btn btn-primary">View Details</a>
                    <button 
                        class="btn btn-danger btn-unfavorite mt-2" 
                        data-id="{{ item.id }}"
                    >
                        <i class="bi bi-heart-fill me-1"></i>Remove
                    </button>
                </div>
            </div>
        </div>
        {% endfor %}
    </div>
    {% else %}
    <div class="alert alert-info text-center" role="alert">
        You have no favorite items. Start browsing and add your favorites!
    </div>
    {% endif %}
</div>

<script>
    // Unfavorite button functionality
    document.addEventListener('DOMContentLoaded', () => {
        const unfavoriteButtons = document.querySelectorAll('.btn-unfavorite');

        unfavoriteButtons.forEach(button => {
            button.addEventListener('click', async () => {
                const itemId = button.getAttribute('data-id');

                const response = await fetch('/favorites/toggle', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({ item_id: itemId })
                });

                const data = await response.json();

                if (response.ok) {
                    // Remove the item from the DOM
                    button.closest('.col-md-4').remove();

                    // Show a success message (optional)
                    if (document.querySelectorAll('.col-md-4').length === 0) {
                        document.querySelector('.container').innerHTML = `
                            <div class="alert alert-info text-center" role="alert">
                                You have no favorite items. Start browsing and add your favorites!
                            </div>`;
                    }
                } else {
                    console.error('Error:', data.error);
                }
            });
        });
    });
</script>
{% endblock %}
